MongoDB string de conexÃ£o: mongodb+srv://francahigor96:Ncj7GvL2rZhrWsuF@cluster0.jjmfkot.mongodb.net/

Passo a passo instalaÃ§Ã£o e criaÃ§Ã£o de API simples:


## ğŸ§° 1. PrÃ©-requisitos (instalaÃ§Ãµes iniciais)

### a) Instale o **Node.js**:

* Acesse: [https://nodejs.org/](https://nodejs.org/)
* Baixe a versÃ£o LTS (recomendada)
* ApÃ³s instalar, abra o terminal e digite:

  ```bash
  node -v
  npm -v
  ```

  Isso deve mostrar as versÃµes instaladas.

### b) Instale o **MongoDB**:

VocÃª pode usar o MongoDB local ou em nuvem. Para facilitar, vamos usar o **MongoDB Atlas (nuvem)**:

1. VÃ¡ em: [https://www.mongodb.com/cloud/atlas](https://www.mongodb.com/cloud/atlas)
2. Crie uma conta gratuita.
3. Crie um cluster gratuito (M0).
4. Crie um usuÃ¡rio com senha e copie a **connection string** (vai precisar depois).

---

## ğŸ“ 2. Crie seu projeto no VS Code

1. Crie uma nova pasta e abra no VS Code.
2. Abra o terminal e rode:

   ```bash
   npm init -y
   ```

---

## ğŸ“¦ 3. Instale os pacotes necessÃ¡rios

```bash
npm install express mongoose dotenv
```

* `express`: framework web para Node
* `mongoose`: ODM para MongoDB
* `dotenv`: para usar variÃ¡veis de ambiente

---

## ğŸ“„ 4. Estrutura de pastas (bÃ¡sica)

```
meu-projeto/
â”‚
â”œâ”€â”€ .env
â”œâ”€â”€ index.js
â”œâ”€â”€ models/
â”‚   â””â”€â”€ Usuario.js
â””â”€â”€ routes/
    â””â”€â”€ usuarios.js
```

---

## ğŸ§  5. Crie o servidor com Express (`index.js`)

```js
require('dotenv').config();
const express = require('express');
const mongoose = require('mongoose');

const app = express();
app.use(express.json());

// ConexÃ£o com MongoDB
mongoose.connect(process.env.MONGO_URI, {
  useNewUrlParser: true,
  useUnifiedTopology: true,
}).then(() => {
  console.log('MongoDB conectado');
}).catch(err => console.error(err));

// Rotas
const usuariosRoutes = require('./routes/usuarios');
app.use('/usuarios', usuariosRoutes);

// Inicia servidor
const PORT = process.env.PORT || 3000;
app.listen(PORT, () => {
  console.log(`Servidor rodando na porta ${PORT}`);
});
```

---

## ğŸŒ± 6. VariÃ¡veis de ambiente (`.env`)

```env
MONGO_URI=mongodb+srv://usuario:senha@cluster.mongodb.net/meubanco?retryWrites=true&w=majority
PORT=3000
```

> Lembre de trocar `usuario`, `senha` e `meubanco` com os dados do MongoDB Atlas.

---

## ğŸ‘¤ 7. Modelo Mongoose (`models/Usuario.js`)

```js
const mongoose = require('mongoose');

const UsuarioSchema = new mongoose.Schema({
  nome: String,
  email: String,
  senha: String,
}, { timestamps: true });

module.exports = mongoose.model('Usuario', UsuarioSchema);
```

---

## ğŸ” 8. Rotas da API (`routes/usuarios.js`)

```js
const express = require('express');
const router = express.Router();
const Usuario = require('../models/Usuario');

// Criar usuÃ¡rio
router.post('/', async (req, res) => {
  const { nome, email, senha } = req.body;
  try {
    const novoUsuario = await Usuario.create({ nome, email, senha });
    res.status(201).json(novoUsuario);
  } catch (err) {
    res.status(500).json({ erro: err.message });
  }
});

// Listar todos os usuÃ¡rios
router.get('/', async (req, res) => {
  try {
    const usuarios = await Usuario.find();
    res.json(usuarios);
  } catch (err) {
    res.status(500).json({ erro: err.message });
  }
});

module.exports = router;
```

---

## â–¶ï¸ 9. Rodando o projeto

No terminal, execute:

```bash
node index.js ou npx nodemon index.js (REINICIA O SERVIDOR AUTOMATICAMENTE APÃ“S MUDANÃ‡AS)
```

VocÃª verÃ¡ algo como:

```
MongoDB conectado
Servidor rodando na porta 3000
```

---

## ğŸ§ª 10. Testando a API

Use o [Insomnia](https://insomnia.rest/) ou [Postman](https://www.postman.com/) para testar as rotas:

* `POST http://localhost:3000/usuarios`

  ```json
  {
    "nome": "Higor",
    "email": "higor@email.com",
    "senha": "123456"
  }
  ```

* `GET http://localhost:3000/usuarios`

---

## Instalando o pacote jsonwebtoken (para gerar e validar token) e bcrypt (para encriptar e validar senha):

npm install jsonwebtoken bcrypt

## Instalando a biblioteca joi (validar os dados recebidos nas rotas antes de criar/atualizar registros no banco)

npm install joi


Testes automatizados sÃ£o essenciais para garantir que a API **funcione como esperado**, especialmente conforme vocÃª adiciona novas funcionalidades.

---

## ğŸ§ª O que vamos usar

Para sua API com Node.js, Express e MongoDB, o combo mais usado Ã©:

| Lib                       | FunÃ§Ã£o                                       |
| ------------------------- | -------------------------------------------- |
| **Jest**                  | Framework de testes (assertivas, execuÃ§Ã£o)   |
| **Supertest**             | Faz chamadas HTTP simuladas Ã  API            |
| **mongodb-memory-server** | Cria um banco MongoDB temporÃ¡rio para testes |

---

## ğŸ“¦ InstalaÃ§Ã£o das dependÃªncias

```bash
npm install --save-dev jest supertest mongodb-memory-server dotenv
```

Em seguida, adicione ao `package.json`:

```json
"scripts": {
  "test": "jest"
}
```

---

## ğŸ§± Estrutura de testes sugerida

```
tests/
â”œâ”€â”€ setup.js
â”œâ”€â”€ usuarios.test.js
â””â”€â”€ tarefas.test.js
```

---

## âš™ï¸ `tests/setup.js` (configuraÃ§Ã£o e teardown do Mongo)

```js
const mongoose = require('mongoose');
const { MongoMemoryServer } = require('mongodb-memory-server');

let mongo;

beforeAll(async () => {
  mongo = await MongoMemoryServer.create();
  const uri = mongo.getUri();
  await mongoose.connect(uri);
});

afterAll(async () => {
  await mongoose.connection.dropDatabase();
  await mongoose.connection.close();
  await mongo.stop();
});

afterEach(async () => {
  const collections = mongoose.connection.collections;
  for (let key in collections) {
    await collections[key].deleteMany();
  }
});
```

No `package.json`, configure o Jest para usar esse arquivo:

```json
"jest": {
  "setupFilesAfterEnv": ["<rootDir>/tests/setup.js"]
}
```

---

## ğŸ§ª `tests/usuarios.test.js`

```js
const request = require('supertest');
const app = require('../src/index'); // exporta app do index.js

describe('Cadastro e login de usuÃ¡rio', () => {
  it('deve cadastrar um novo usuÃ¡rio', async () => {
    const res = await request(app)
      .post('/usuarios/cadastrar')
      .send({ nome: 'JoÃ£o', email: 'joao@email.com', senha: '123456' });

    expect(res.statusCode).toBe(201);
  });

  it('deve logar com sucesso e retornar token', async () => {
    await request(app)
      .post('/usuarios/cadastrar')
      .send({ nome: 'Maria', email: 'maria@email.com', senha: '123456' });

    const res = await request(app)
      .post('/usuarios/login')
      .send({ email: 'maria@email.com', senha: '123456' });

    expect(res.statusCode).toBe(200);
    expect(res.body.token).toBeDefined();
  });
});
```

---

## ğŸ“„ Para isso funcionar, altere `src/index.js` para exportar o `app`

```js
const express = require('express');
const mongoose = require('mongoose');
require('dotenv').config();

const app = express();
app.use(express.json());

app.use('/usuarios', require('./routes/usuarios'));
app.use('/tarefas', require('./routes/tarefas'));

// sÃ³ conecta se nÃ£o estiver em modo de teste
if (process.env.NODE_ENV !== 'test') {
  mongoose.connect(process.env.MONGO_URL)
    .then(() => console.log('MongoDB conectado'))
    .catch(err => console.error(err));

  app.listen(3000, () => console.log('Servidor rodando na porta 3000'));
}

module.exports = app;
```

---

## ğŸ“Œ Teste para tarefas (`tests/tarefas.test.js`)

VocÃª pode seguir a mesma ideia:

* Criar um usuÃ¡rio
* Logar e pegar o token
* Criar tarefas com o token
* Testar se o GET retorna apenas as tarefas daquele usuÃ¡rio

Se quiser, posso montar esse teste completo pra tarefas tambÃ©m.

---

## âœ… Comandos

```bash
npm test
```

---

Quer que eu monte agora o `tarefas.test.js` com teste completo de autenticaÃ§Ã£o + CRUD?

